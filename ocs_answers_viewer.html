<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCSç­”é¢˜è®°å½•å¯è§†åŒ–</title>
    <script src="chart.js.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #F2F6FC;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #303133;
            margin-bottom: 30px;
            font-size: 2em;
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-primary {
            background: #409EFF;
            color: white;
        }

        .btn-primary:hover {
            background: #66B1FF;
            box-shadow: 0 2px 4px rgba(64, 158, 255, 0.3);
        }

        .btn-secondary {
            background: #909399;
            color: white;
        }

        .btn-secondary:hover {
            background: #A6A9AD;
        }

        .btn-danger {
            background: #F56C6C;
            color: white;
        }

        .btn-danger:hover {
            background: #F78989;
            box-shadow: 0 2px 4px rgba(245, 108, 108, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #409EFF;
            color: white;
            padding: 20px;
            border-radius: 4px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .stat-card p {
            font-size: 0.9em;
            opacity: 0.95;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 4px;
            border: 1px solid #EBEEF5;
            position: relative;
            height: 400px;
        }

        .chart-container h3 {
            margin-bottom: 15px;
            color: #303133;
            text-align: center;
            font-weight: 600;
        }

        .table-container {
            margin-top: 20px;
            border-radius: 4px;
            border: 1px solid #EBEEF5;
            max-height: 600px;
            overflow: auto;
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: #409EFF;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #EBEEF5;
        }

        th {
            font-weight: 600;
            background: #409EFF;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tbody tr:hover {
            background: #F5F7FA;
        }

        tbody tr:nth-child(even) {
            background: #FAFAFA;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #909399;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #409EFF;
        }

        .filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-input {
            padding: 10px 15px;
            border: 1px solid #DCDFE6;
            border-radius: 4px;
            font-size: 14px;
            flex: 1;
            min-width: 200px;
            color: #606266;
            transition: border-color 0.2s;
        }

        .filter-input:focus {
            outline: none;
            border-color: #409EFF;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-single { background: #ECF5FF; color: #409EFF; border: 1px solid #D9ECFF; }
        .badge-multiple { background: #F4F4F5; color: #909399; border: 1px solid #E4E7ED; }
        .badge-judgement { background: #F0F9FF; color: #67C23A; border: 1px solid #E1F3D8; }
        .badge-completion { background: #FDF6EC; color: #E6A23C; border: 1px solid #FAECD8; }

        .reasoning-yes { color: #F56C6C; font-weight: 600; }
        .reasoning-no { color: #909399; }

        /* Tooltipæ ·å¼ */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            padding: 12px 16px;
            background: rgba(48, 49, 51, 0.95);
            color: white;
            border-radius: 4px;
            font-size: 14px;
            white-space: pre-wrap;
            max-width: 700px;
            min-width: 400px;
            width: max-content;
            z-index: 99999;
            margin-bottom: 0;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            pointer-events: none;
            word-wrap: break-word;
            line-height: 1.6;
            max-height: 70vh;
            overflow-y: auto;
        }

        [data-tooltip]:hover::before {
            content: '';
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, calc(-50% - 200px));
            border: 8px solid transparent;
            border-top-color: rgba(48, 49, 51, 0.95);
            margin-bottom: 0;
            z-index: 100000;
            pointer-events: none;
        }

        /* å¯ç‚¹å‡»çš„é¢˜ç›®æ ·å¼ */
        .question-cell {
            cursor: pointer;
            color: #409EFF;
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        .question-cell:hover {
            color: #66B1FF;
            text-decoration-color: #66B1FF;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 4px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid #EBEEF5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #409EFF;
            color: white;
            border-radius: 4px 4px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
            font-weight: 600;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .detail-item {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #EBEEF5;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #409EFF;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .detail-value {
            color: #303133;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .detail-value.empty {
            color: #999;
            font-style: italic;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #DCDFE6;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            color: #606266;
            font-size: 14px;
            transition: all 0.2s;
        }

        .pagination button:hover:not(:disabled) {
            background: #409EFF;
            color: white;
            border-color: #409EFF;
        }

        .pagination button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .pagination button.active {
            background: #409EFF;
            color: white;
            border-color: #409EFF;
        }

        .pagination span {
            color: #606266;
            font-size: 14px;
        }

        .pagination select {
            padding: 6px 10px;
            border: 1px solid #DCDFE6;
            border-radius: 4px;
            font-size: 14px;
            color: #606266;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š OCSç­”é¢˜è®°å½•å¯è§†åŒ–</h1>
        
        <div class="controls">
            <div class="file-input-wrapper">
                <label for="csvFile" class="btn btn-primary">ğŸ“ é€‰æ‹©CSVæ–‡ä»¶</label>
                <input type="file" id="csvFile" accept=".csv" />
            </div>
            <button class="btn btn-secondary" onclick="loadDefaultFile()">ğŸ”„ åŠ è½½é»˜è®¤æ–‡ä»¶</button>
            <button class="btn btn-secondary" onclick="exportData()">ğŸ’¾ å¯¼å‡ºæ•°æ®</button>
            <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
        </div>

        <div id="emptyState" class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="12" y1="18" x2="12" y2="12"></line>
                <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
            <p>è¯·é€‰æ‹©CSVæ–‡ä»¶å¼€å§‹æŸ¥çœ‹æ•°æ®</p>
        </div>

        <div id="content" style="display: none;">
            <div class="filter-bar">
                <input type="text" id="searchInput" class="filter-input" placeholder="ğŸ” æœç´¢é¢˜ç›®ã€ç­”æ¡ˆ...">
                <select id="typeFilter" class="filter-input" style="max-width: 150px;">
                    <option value="">æ‰€æœ‰é¢˜å‹</option>
                    <option value="å•é€‰é¢˜">å•é€‰é¢˜</option>
                    <option value="å¤šé€‰é¢˜">å¤šé€‰é¢˜</option>
                    <option value="åˆ¤æ–­é¢˜">åˆ¤æ–­é¢˜</option>
                    <option value="å¡«ç©ºé¢˜">å¡«ç©ºé¢˜</option>
                </select>
                <select id="reasoningFilter" class="filter-input" style="max-width: 150px;">
                    <option value="">æ‰€æœ‰æ¨¡å¼</option>
                    <option value="æ˜¯">æ€è€ƒæ¨¡å¼</option>
                    <option value="å¦">æ™®é€šæ¨¡å¼</option>
                </select>
                <select id="dateFilter" class="filter-input" style="max-width: 180px;">
                    <option value="all">å…¨éƒ¨æ—¥æœŸ</option>
                    <option value="today">ä»Šå¤©</option>
                    <option value="7">è¿‘7å¤©</option>
                    <option value="30">è¿‘30å¤©</option>
                    <option value="custom">æŒ‡å®šæ—¥æœŸ</option>
                </select>
                <input type="date" id="customDate" class="filter-input" style="max-width: 180px; display: none;" placeholder="é€‰æ‹©æ—¥æœŸ">
            </div>

            <div class="stats-grid" id="statsGrid"></div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>é¢˜å‹åˆ†å¸ƒ</h3>
                    <canvas id="typeChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>ç­”é¢˜è€—æ—¶åˆ†å¸ƒ</h3>
                    <canvas id="timeChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>æ€è€ƒæ¨¡å¼ä½¿ç”¨æƒ…å†µ</h3>
                    <canvas id="reasoningChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>æ¯æ—¥ç­”é¢˜é‡</h3>
                    <canvas id="dailyChart"></canvas>
                </div>
            </div>

            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>æ—¶é—´æˆ³</th>
                            <th>é¢˜å‹</th>
                            <th>é¢˜ç›®</th>
                            <th>é€‰é¡¹</th>
                            <th>åŸå§‹å›ç­”</th>
                            <th>æ€è€ƒè¿‡ç¨‹</th>
                            <th>å¤„ç†åç­”æ¡ˆ</th>
                            <th>AIè€—æ—¶</th>
                            <th>æ€»è€—æ—¶</th>
                            <th>æ¨¡å‹</th>
                            <th>æ€è€ƒæ¨¡å¼</th>
                            <th>è¾“å…¥Token</th>
                            <th>è¾“å‡ºToken</th>
                            <th>æ€»Token</th>
                            <th>è´¹ç”¨(å…ƒ)</th>
                            <th>æä¾›å•†</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>

            <div class="pagination" id="pagination">
                <button id="firstPage">é¦–é¡µ</button>
                <button id="prevPage">ä¸Šä¸€é¡µ</button>
                <span id="pageInfo">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                <button id="nextPage">ä¸‹ä¸€é¡µ</button>
                <button id="lastPage">æœ«é¡µ</button>
                <select id="pageSizeSelect">
                    <option value="10">10æ¡/é¡µ</option>
                    <option value="20" selected>20æ¡/é¡µ</option>
                    <option value="50">50æ¡/é¡µ</option>
                    <option value="100">100æ¡/é¡µ</option>
                </select>
            </div>
        </div>
    </div>

    <!-- é¢˜ç›®è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“‹ é¢˜ç›®è¯¦æƒ…</h2>
                <span class="close" onclick="closeDetailModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- è¯¦æƒ…å†…å®¹å°†é€šè¿‡JavaScriptå¡«å…… -->
            </div>
        </div>
    </div>

    <script>
        let csvData = [];
        let filteredData = [];
        let charts = {};
        
        // åˆ†é¡µç›¸å…³å˜é‡
        let currentPage = 1;
        let pageSize = 20;
        let totalPages = 1;

        // æ–‡ä»¶é€‰æ‹©
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                readCSV(file);
            }
        });

        // æœç´¢å’Œç­›é€‰
        document.getElementById('searchInput').addEventListener('input', filterData);
        document.getElementById('typeFilter').addEventListener('change', filterData);
        document.getElementById('reasoningFilter').addEventListener('change', filterData);
        document.getElementById('dateFilter').addEventListener('change', function() {
            const customDateInput = document.getElementById('customDate');
            if (this.value === 'custom') {
                customDateInput.style.display = 'block';
            } else {
                customDateInput.style.display = 'none';
            }
            filterData();
        });
        document.getElementById('customDate').addEventListener('change', filterData);

        // åˆ†é¡µæ§åˆ¶
        document.getElementById('firstPage').addEventListener('click', () => goToPage(1));
        document.getElementById('prevPage').addEventListener('click', () => goToPage(currentPage - 1));
        document.getElementById('nextPage').addEventListener('click', () => goToPage(currentPage + 1));
        document.getElementById('lastPage').addEventListener('click', () => goToPage(totalPages));
        document.getElementById('pageSizeSelect').addEventListener('change', function() {
            pageSize = parseInt(this.value);
            currentPage = 1;
            updateTable();
        });

        // è¯»å–CSVæ–‡ä»¶
        function readCSV(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                parseCSV(text);
            };
            reader.readAsText(file, 'UTF-8');
        }

        // åŠ è½½é»˜è®¤æ–‡ä»¶
        function loadDefaultFile() {
            fetch('/api/csv')
                .then(response => {
                    if (!response.ok) {
                        console.error('åŠ è½½CSVå¤±è´¥:', response.status, response.statusText);
                        return null;
                    }
                    return response.text();
                })
                .then(text => {
                    if (text) {
                        parseCSV(text);
                    } else {
                        console.log('CSVæ–‡ä»¶ä¸ºç©ºæˆ–ä¸å­˜åœ¨');
                    }
                })
                .catch(err => {
                    console.error('åŠ è½½CSVæ–‡ä»¶å¤±è´¥:', err);
                    alert('åŠ è½½CSVæ–‡ä»¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶');
                });
        }

        // è§£æCSVï¼ˆæ”¯æŒå¤šè¡Œå­—æ®µï¼‰
        function parseCSV(text) {
            // å…ˆè¯»å–è¡¨å¤´
            const firstLineEnd = text.indexOf('\n');
            if (firstLineEnd === -1) {
                alert('CSVæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼šæ²¡æœ‰æ‰¾åˆ°æ¢è¡Œç¬¦');
                return;
            }
            
            const headerLine = text.substring(0, firstLineEnd);
            const headers = parseCSVLine(headerLine).map(h => h.trim());
            
            if (headers.length === 0) {
                alert('CSVæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼šè¡¨å¤´ä¸ºç©º');
                return;
            }
            
            csvData = [];
            
            // è§£ææ•°æ®è¡Œï¼ˆéœ€è¦è€ƒè™‘å¼•å·å†…çš„æ¢è¡Œç¬¦ï¼‰
            let rest = text.substring(firstLineEnd + 1);
            let currentLine = '';
            let inQuotes = false;
            
            for (let i = 0; i < rest.length; i++) {
                const char = rest[i];
                const nextChar = rest[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // è½¬ä¹‰çš„å¼•å·
                        currentLine += '"';
                        i++;
                    } else {
                        // åˆ‡æ¢å¼•å·çŠ¶æ€
                        inQuotes = !inQuotes;
                        currentLine += char;
                    }
                } else if (char === '\n' && !inQuotes) {
                    // çœŸæ­£çš„è¡Œç»“æŸï¼ˆä¸åœ¨å¼•å·å†…ï¼‰
                    if (currentLine.trim()) {
                        const values = parseCSVLine(currentLine);
                        if (values.length > 0) {
                            const row = {};
                            headers.forEach((header, index) => {
                                row[header] = (values[index] || '').trim();
                            });
                            csvData.push(row);
                        }
                    }
                    currentLine = '';
                } else {
                    currentLine += char;
                }
            }
            
            // å¤„ç†æœ€åä¸€è¡Œï¼ˆå¦‚æœæ–‡ä»¶æœ«å°¾æ²¡æœ‰æ¢è¡Œç¬¦ï¼‰
            if (currentLine.trim()) {
                const values = parseCSVLine(currentLine);
                if (values.length > 0) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = (values[index] || '').trim();
                    });
                    csvData.push(row);
                }
            }

            if (csvData.length === 0) {
                alert('CSVæ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆæ•°æ®');
                return;
            }

            // æŒ‰æ—¶é—´æˆ³é™åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            csvData.sort((a, b) => {
                const dateA = new Date(a['æ—¶é—´æˆ³'] || '');
                const dateB = new Date(b['æ—¶é—´æˆ³'] || '');
                return dateB - dateA;  // é™åº
            });

            filteredData = csvData;
            currentPage = 1;  // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            displayData();
        }

        // è§£æCSVè¡Œï¼ˆå¤„ç†å¼•å·å†…çš„é€—å·å’Œæ¢è¡Œç¬¦ï¼‰
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            // å¤„ç†è½¬ä¹‰çš„å¼•å·ï¼ˆåŒå¼•å·è½¬ä¹‰ï¼‰
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // è½¬ä¹‰çš„å¼•å·ï¼ˆåŒå¼•å·ï¼‰
                        current += '"';
                        i++; // è·³è¿‡ä¸‹ä¸€ä¸ªå¼•å·
                    } else {
                        // å¼€å§‹æˆ–ç»“æŸå¼•å·
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // å­—æ®µåˆ†éš”ç¬¦ï¼ˆä¸åœ¨å¼•å·å†…ï¼‰
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            // æ·»åŠ æœ€åä¸€ä¸ªå­—æ®µ
            result.push(current);
            return result;
        }

        // ç­›é€‰æ•°æ®
        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const reasoningFilter = document.getElementById('reasoningFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            const customDate = document.getElementById('customDate').value;

            filteredData = csvData.filter(row => {
                const matchSearch = !searchTerm || 
                    (row['é¢˜ç›®'] && row['é¢˜ç›®'].toLowerCase().includes(searchTerm)) ||
                    (row['å¤„ç†åç­”æ¡ˆ'] && row['å¤„ç†åç­”æ¡ˆ'].toLowerCase().includes(searchTerm)) ||
                    (row['åŸå§‹å›ç­”'] && row['åŸå§‹å›ç­”'].toLowerCase().includes(searchTerm));

                const matchType = !typeFilter || row['é¢˜å‹'] === typeFilter;
                const matchReasoning = !reasoningFilter || row['æ€è€ƒæ¨¡å¼'] === reasoningFilter;

                // æ—¥æœŸç­›é€‰
                let matchDate = true;
                if (dateFilter && dateFilter !== 'all' && row['æ—¶é—´æˆ³']) {
                    const rowDate = new Date(row['æ—¶é—´æˆ³'].split(' ')[0]);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    if (dateFilter === 'today') {
                        const rowDateOnly = new Date(rowDate);
                        rowDateOnly.setHours(0, 0, 0, 0);
                        matchDate = rowDateOnly.getTime() === today.getTime();
                    } else if (dateFilter === 'custom' && customDate) {
                        const customDateOnly = new Date(customDate);
                        customDateOnly.setHours(0, 0, 0, 0);
                        const rowDateOnly = new Date(rowDate);
                        rowDateOnly.setHours(0, 0, 0, 0);
                        matchDate = rowDateOnly.getTime() === customDateOnly.getTime();
                    } else if (!isNaN(dateFilter)) {
                        // è¿‘Nå¤©
                        const daysAgo = parseInt(dateFilter);
                        const cutoffDate = new Date(today);
                        cutoffDate.setDate(cutoffDate.getDate() - daysAgo);
                        rowDate.setHours(0, 0, 0, 0);
                        matchDate = rowDate >= cutoffDate && rowDate <= today;
                    }
                }

                return matchSearch && matchType && matchReasoning && matchDate;
            });

            // æŒ‰æ—¶é—´æˆ³é™åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            filteredData.sort((a, b) => {
                const dateA = new Date(a['æ—¶é—´æˆ³'] || '');
                const dateB = new Date(b['æ—¶é—´æˆ³'] || '');
                return dateB - dateA;  // é™åº
            });

            currentPage = 1;  // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            displayData();
        }

        // æ˜¾ç¤ºæ•°æ®
        function displayData() {
            if (filteredData.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('content').style.display = 'none';
                return;
            }

            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('content').style.display = 'block';

            updateStats();
            updateCharts();
            updateTable();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const total = filteredData.length;
            const avgTime = total > 0 ? filteredData.reduce((sum, row) => sum + parseFloat(row['AIè€—æ—¶(ç§’)'] || 0), 0) / total : 0;
            const reasoningCount = filteredData.filter(row => row['æ€è€ƒæ¨¡å¼'] === 'æ˜¯').length;
            const totalTime = filteredData.reduce((sum, row) => sum + parseFloat(row['æ€»è€—æ—¶(ç§’)'] || 0), 0);
            
            // è®¡ç®—è´¹ç”¨ç»Ÿè®¡
            const totalCost = filteredData.reduce((sum, row) => sum + parseFloat(row['è´¹ç”¨(å…ƒ)'] || 0), 0);
            const totalTokens = filteredData.reduce((sum, row) => sum + parseInt(row['æ€»Token'] || 0), 0);
            const totalInputTokens = filteredData.reduce((sum, row) => sum + parseInt(row['è¾“å…¥Token'] || 0), 0);
            const totalOutputTokens = filteredData.reduce((sum, row) => sum + parseInt(row['è¾“å‡ºToken'] || 0), 0);
            const avgCost = total > 0 ? totalCost / total : 0;

            const statsHTML = `
                <div class="stat-card">
                    <h3>${total}</h3>
                    <p>æ€»ç­”é¢˜æ•°</p>
                </div>
                <div class="stat-card">
                    <h3>${avgTime.toFixed(2)}ç§’</h3>
                    <p>å¹³å‡AIè€—æ—¶</p>
                </div>
                <div class="stat-card">
                    <h3>${reasoningCount}</h3>
                    <p>æ€è€ƒæ¨¡å¼ç­”é¢˜</p>
                </div>
                <div class="stat-card">
                    <h3>${(totalTime / 60).toFixed(1)}åˆ†é’Ÿ</h3>
                    <p>æ€»è€—æ—¶</p>
                </div>
                <div class="stat-card" style="background: #F56C6C;">
                    <h3>Â¥${totalCost.toFixed(4)}</h3>
                    <p>æ€»è´¹ç”¨</p>
                </div>
                <div class="stat-card" style="background: #909399;">
                    <h3>${totalTokens.toLocaleString()}</h3>
                    <p>æ€»Tokenæ•°</p>
                </div>
                <div class="stat-card" style="background: #67C23A;">
                    <h3>${totalInputTokens.toLocaleString()}</h3>
                    <p>è¾“å…¥Token</p>
                </div>
                <div class="stat-card" style="background: #E6A23C;">
                    <h3>${totalOutputTokens.toLocaleString()}</h3>
                    <p>è¾“å‡ºToken</p>
                </div>
            `;

            document.getElementById('statsGrid').innerHTML = statsHTML;
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            // é¢˜å‹åˆ†å¸ƒ
            const typeCounts = {};
            filteredData.forEach(row => {
                const type = row['é¢˜å‹'] || 'æœªçŸ¥';
                typeCounts[type] = (typeCounts[type] || 0) + 1;
            });

            updateChart('typeChart', {
                type: 'doughnut',
                data: {
                    labels: Object.keys(typeCounts),
                    datasets: [{
                        data: Object.values(typeCounts),
                        backgroundColor: ['#409EFF', '#67C23A', '#E6A23C', '#F56C6C', '#909399']
                    }]
                }
            });

            // ç­”é¢˜è€—æ—¶åˆ†å¸ƒ
            const timeRanges = {
                '0-2ç§’': 0,
                '2-5ç§’': 0,
                '5-10ç§’': 0,
                '10ç§’ä»¥ä¸Š': 0
            };

            filteredData.forEach(row => {
                const time = parseFloat(row['AIè€—æ—¶(ç§’)'] || 0);
                if (time <= 2) timeRanges['0-2ç§’']++;
                else if (time <= 5) timeRanges['2-5ç§’']++;
                else if (time <= 10) timeRanges['5-10ç§’']++;
                else timeRanges['10ç§’ä»¥ä¸Š']++;
            });

            updateChart('timeChart', {
                type: 'bar',
                data: {
                    labels: Object.keys(timeRanges),
                    datasets: [{
                        label: 'é¢˜ç›®æ•°é‡',
                        data: Object.values(timeRanges),
                        backgroundColor: '#409EFF'
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // æ€è€ƒæ¨¡å¼ä½¿ç”¨æƒ…å†µ
            const reasoningCounts = {
                'æ€è€ƒæ¨¡å¼': filteredData.filter(row => row['æ€è€ƒæ¨¡å¼'] === 'æ˜¯').length,
                'æ™®é€šæ¨¡å¼': filteredData.filter(row => row['æ€è€ƒæ¨¡å¼'] === 'å¦').length
            };

            updateChart('reasoningChart', {
                type: 'pie',
                data: {
                    labels: Object.keys(reasoningCounts),
                    datasets: [{
                        data: Object.values(reasoningCounts),
                        backgroundColor: ['#E6A23C', '#409EFF']
                    }]
                }
            });

            // æ¯æ—¥ç­”é¢˜é‡
            const dailyCounts = {};
            filteredData.forEach(row => {
                const date = (row['æ—¶é—´æˆ³'] || '').split(' ')[0];
                if (date) {
                    dailyCounts[date] = (dailyCounts[date] || 0) + 1;
                }
            });

            const sortedDates = Object.keys(dailyCounts).sort();
            updateChart('dailyChart', {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'ç­”é¢˜æ•°é‡',
                        data: sortedDates.map(date => dailyCounts[date]),
                        borderColor: '#409EFF',
                        backgroundColor: 'rgba(64, 158, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // æ›´æ–°å•ä¸ªå›¾è¡¨
        function updateChart(canvasId, config) {
            const canvas = document.getElementById(canvasId);
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }
            charts[canvasId] = new Chart(canvas, {
                ...config,
                options: {
                    ...config.options,
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // å·¥å…·å‡½æ•°ï¼šè½¬ä¹‰HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // å·¥å…·å‡½æ•°ï¼šåˆ›å»ºå¸¦tooltipçš„å•å…ƒæ ¼
        function createCellWithTooltip(text, maxLength = 30) {
            const fullText = text || '';
            const displayText = fullText.length > maxLength ? fullText.substring(0, maxLength) + '...' : fullText;
            if (fullText.length > maxLength) {
                return `<span data-tooltip="${escapeHtml(fullText)}">${escapeHtml(displayText)}</span>`;
            }
            return escapeHtml(displayText);
        }

        // æ›´æ–°è¡¨æ ¼
        function updateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // è®¡ç®—åˆ†é¡µ
            totalPages = Math.ceil(filteredData.length / pageSize);
            if (totalPages === 0) totalPages = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            if (currentPage < 1) currentPage = 1;

            // è·å–å½“å‰é¡µçš„æ•°æ®
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, filteredData.length);
            const pageData = filteredData.slice(startIndex, endIndex);

            pageData.forEach((row, index) => {
                const actualIndex = startIndex + index;  // åœ¨filteredDataä¸­çš„å®é™…ç´¢å¼•
                const tr = document.createElement('tr');
                const typeClass = {
                    'å•é€‰é¢˜': 'badge-single',
                    'å¤šé€‰é¢˜': 'badge-multiple',
                    'åˆ¤æ–­é¢˜': 'badge-judgement',
                    'å¡«ç©ºé¢˜': 'badge-completion'
                }[row['é¢˜å‹']] || '';

                const questionText = row['é¢˜ç›®'] || '';
                const questionDisplay = questionText.length > 50 ? questionText.substring(0, 50) + '...' : questionText;
                
                // åˆ›å»ºæ‰€æœ‰å•å…ƒæ ¼
                const timeCell = document.createElement('td');
                timeCell.innerHTML = escapeHtml(row['æ—¶é—´æˆ³'] || '');
                
                const typeCell = document.createElement('td');
                typeCell.innerHTML = `<span class="badge ${typeClass}">${escapeHtml(row['é¢˜å‹'] || '')}</span>`;
                
                // åˆ›å»ºé¢˜ç›®å•å…ƒæ ¼ï¼ˆå¯ç‚¹å‡»ï¼‰
                const questionCell = document.createElement('td');
                questionCell.className = 'question-cell';
                questionCell.setAttribute('data-index', actualIndex);  // ä½¿ç”¨å®é™…ç´¢å¼•
                questionCell.textContent = questionDisplay;
                if (questionText.length > 50) {
                    questionCell.setAttribute('data-tooltip', questionText);
                }
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆä»data-indexå±æ€§è·å–ç´¢å¼•ï¼‰
                questionCell.addEventListener('click', function() {
                    const idx = parseInt(this.getAttribute('data-index'), 10);
                    if (!isNaN(idx)) {
                        showDetailModal(idx);
                    } else {
                        console.error('Invalid index from data-index:', this.getAttribute('data-index'));
                    }
                });
                
                const optionsCell = document.createElement('td');
                optionsCell.innerHTML = createCellWithTooltip(row['é€‰é¡¹'] || '', 30);
                
                const rawAnswerCell = document.createElement('td');
                rawAnswerCell.innerHTML = createCellWithTooltip(row['åŸå§‹å›ç­”'] || '', 30);
                
                const reasoningCell = document.createElement('td');
                reasoningCell.innerHTML = createCellWithTooltip(row['æ€è€ƒè¿‡ç¨‹'] || '', 30);
                
                const processedAnswerCell = document.createElement('td');
                processedAnswerCell.innerHTML = escapeHtml(row['å¤„ç†åç­”æ¡ˆ'] || '');
                
                const aiTimeCell = document.createElement('td');
                aiTimeCell.innerHTML = escapeHtml(row['AIè€—æ—¶(ç§’)'] || '') + 'ç§’';
                
                const totalTimeCell = document.createElement('td');
                totalTimeCell.innerHTML = escapeHtml(row['æ€»è€—æ—¶(ç§’)'] || '') + 'ç§’';
                
                const modelCell = document.createElement('td');
                modelCell.innerHTML = escapeHtml(row['æ¨¡å‹'] || '');
                
                const reasoningModeCell = document.createElement('td');
                reasoningModeCell.className = row['æ€è€ƒæ¨¡å¼'] === 'æ˜¯' ? 'reasoning-yes' : 'reasoning-no';
                reasoningModeCell.innerHTML = escapeHtml(row['æ€è€ƒæ¨¡å¼'] || '');
                
                const inputTokenCell = document.createElement('td');
                inputTokenCell.innerHTML = (row['è¾“å…¥Token'] || '0').toLocaleString();
                
                const outputTokenCell = document.createElement('td');
                outputTokenCell.innerHTML = (row['è¾“å‡ºToken'] || '0').toLocaleString();
                
                const totalTokenCell = document.createElement('td');
                totalTokenCell.innerHTML = (row['æ€»Token'] || '0').toLocaleString();
                
                const costCell = document.createElement('td');
                const cost = parseFloat(row['è´¹ç”¨(å…ƒ)'] || 0);
                costCell.innerHTML = cost > 0 ? `Â¥${cost.toFixed(6)}` : '-';
                costCell.style.color = cost > 0 ? '#e74c3c' : '#999';
                costCell.style.fontWeight = cost > 0 ? 'bold' : 'normal';
                
                const providerCell = document.createElement('td');
                providerCell.innerHTML = escapeHtml(row['æä¾›å•†'] || '');
                
                // å°†å•å…ƒæ ¼æ·»åŠ åˆ°è¡Œ
                tr.appendChild(timeCell);
                tr.appendChild(typeCell);
                tr.appendChild(questionCell);
                tr.appendChild(optionsCell);
                tr.appendChild(rawAnswerCell);
                tr.appendChild(reasoningCell);
                tr.appendChild(processedAnswerCell);
                tr.appendChild(aiTimeCell);
                tr.appendChild(totalTimeCell);
                tr.appendChild(modelCell);
                tr.appendChild(reasoningModeCell);
                tr.appendChild(inputTokenCell);
                tr.appendChild(outputTokenCell);
                tr.appendChild(totalTokenCell);
                tr.appendChild(costCell);
                tr.appendChild(providerCell);
                
                tbody.appendChild(tr);
            });

            // æ›´æ–°åˆ†é¡µæ§ä»¶
            updatePagination();
        }

        // æ›´æ–°åˆ†é¡µæ§ä»¶
        function updatePagination() {
            const pageInfo = document.getElementById('pageInfo');
            const firstPageBtn = document.getElementById('firstPage');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const lastPageBtn = document.getElementById('lastPage');

            pageInfo.textContent = `ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µï¼ˆå…± ${filteredData.length} æ¡è®°å½•ï¼‰`;

            firstPageBtn.disabled = currentPage === 1;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            lastPageBtn.disabled = currentPage === totalPages;
        }

        // è·³è½¬åˆ°æŒ‡å®šé¡µ
        function goToPage(page) {
            if (page < 1 || page > totalPages || page === currentPage) {
                return;
            }
            currentPage = page;
            updateTable();
        }

        // æ˜¾ç¤ºé¢˜ç›®è¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰
        function showDetailModal(index) {
            // ä¸¥æ ¼éªŒè¯ç´¢å¼•
            if (index === undefined || index === null || isNaN(index)) {
                console.error('Invalid index:', index, 'Type:', typeof index);
                return;
            }
            
            const numIndex = parseInt(index, 10);
            if (isNaN(numIndex)) {
                console.error('Cannot parse index:', index);
                return;
            }
            
            if (numIndex < 0 || numIndex >= filteredData.length) {
                console.error('Index out of range:', numIndex, 'filteredData length:', filteredData.length);
                return;
            }
            
            const row = filteredData[numIndex];
            if (!row || typeof row !== 'object') {
                console.error('Row not found at index:', numIndex, 'filteredData:', filteredData);
                return;
            }
            
            showDetailModalContent(row);
        }

        // æ˜¾ç¤ºé¢˜ç›®è¯¦æƒ…æ¨¡æ€æ¡†å†…å®¹
        function showDetailModalContent(row) {
            if (!row || typeof row !== 'object') {
                console.error('Invalid row data:', row);
                return;
            }
            
            const modal = document.getElementById('detailModal');
            const modalBody = document.getElementById('modalBody');
            
            if (!modal || !modalBody) {
                console.error('Modal elements not found');
                return;
            }
            
            const typeClass = {
                'å•é€‰é¢˜': 'badge-single',
                'å¤šé€‰é¢˜': 'badge-multiple',
                'åˆ¤æ–­é¢˜': 'badge-judgement',
                'å¡«ç©ºé¢˜': 'badge-completion'
            }[row['é¢˜å‹']] || '';

            modalBody.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">æ—¶é—´æˆ³</div>
                    <div class="detail-value">${escapeHtml(row['æ—¶é—´æˆ³'] || '')}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">é¢˜å‹</div>
                    <div class="detail-value"><span class="badge ${typeClass}">${escapeHtml(row['é¢˜å‹'] || '')}</span></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">é¢˜ç›®</div>
                    <div class="detail-value">${escapeHtml(row['é¢˜ç›®'] || '') || '<span class="empty">æ— </span>'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">é€‰é¡¹</div>
                    <div class="detail-value">${escapeHtml(row['é€‰é¡¹'] || '') || '<span class="empty">æ— é€‰é¡¹</span>'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">åŸå§‹å›ç­”</div>
                    <div class="detail-value">${escapeHtml(row['åŸå§‹å›ç­”'] || '') || '<span class="empty">æ— </span>'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">æ€è€ƒè¿‡ç¨‹</div>
                    <div class="detail-value">${escapeHtml(row['æ€è€ƒè¿‡ç¨‹'] || '') || '<span class="empty">æ— æ€è€ƒè¿‡ç¨‹</span>'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">å¤„ç†åç­”æ¡ˆ</div>
                    <div class="detail-value">${escapeHtml(row['å¤„ç†åç­”æ¡ˆ'] || '') || '<span class="empty">æ— </span>'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">AIè€—æ—¶</div>
                    <div class="detail-value">${escapeHtml(row['AIè€—æ—¶(ç§’)'] || '')}ç§’</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">æ€»è€—æ—¶</div>
                    <div class="detail-value">${escapeHtml(row['æ€»è€—æ—¶(ç§’)'] || '')}ç§’</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">æ¨¡å‹</div>
                    <div class="detail-value">${escapeHtml(row['æ¨¡å‹'] || '') || '<span class="empty">æœªçŸ¥</span>'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">æ€è€ƒæ¨¡å¼</div>
                    <div class="detail-value"><span class="${row['æ€è€ƒæ¨¡å¼'] === 'æ˜¯' ? 'reasoning-yes' : 'reasoning-no'}">${escapeHtml(row['æ€è€ƒæ¨¡å¼'] || '')}</span></div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        // å…³é—­è¯¦æƒ…æ¨¡æ€æ¡†
        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('detailModal');
            if (event.target === modal) {
                closeDetailModal();
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            if (filteredData.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }

            const headers = Object.keys(filteredData[0]);
            const csvContent = [
                headers.join(','),
                ...filteredData.map(row => 
                    headers.map(header => {
                        const value = row[header] || '';
                        return `"${value.replace(/"/g, '""')}"`;
                    }).join(',')
                )
            ].join('\n');

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ocs_answers_export_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // æ¸…ç©ºæ•°æ®ï¼ˆæ¸…ç©ºCSVæ–‡ä»¶ï¼‰
        function clearData() {
            if (csvData.length === 0 && filteredData.length === 0) {
                alert('å½“å‰æ²¡æœ‰æ•°æ®å¯æ¸…ç©º');
                return;
            }

            const totalCount = csvData.length || filteredData.length;
            if (confirm(`ç¡®å®šè¦æ¸…ç©ºCSVæ–‡ä»¶å—ï¼Ÿ\n\nå½“å‰å…±æœ‰ ${totalCount} æ¡è®°å½•\n\næ­¤æ“ä½œå°†æ¸…ç©ºCSVæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®ï¼ˆä¿ç•™è¡¨å¤´ï¼‰ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                // è°ƒç”¨APIæ¸…ç©ºCSVæ–‡ä»¶
                fetch('/api/csv/clear', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // æ¸…ç©ºæ•°æ®æ•°ç»„
                        csvData = [];
                        filteredData = [];
                        
                        // æ¸…ç©ºè¡¨æ ¼
                        const tbody = document.getElementById('tableBody');
                        if (tbody) {
                            tbody.innerHTML = '';
                        }
                        
                        // æ¸…ç©ºç»Ÿè®¡ä¿¡æ¯
                        const statsGrid = document.getElementById('statsGrid');
                        if (statsGrid) {
                            statsGrid.innerHTML = '';
                        }
                        
                        // é”€æ¯æ‰€æœ‰å›¾è¡¨
                        Object.keys(charts).forEach(key => {
                            if (charts[key]) {
                                try {
                                    charts[key].destroy();
                                } catch (e) {
                                    console.warn('é”€æ¯å›¾è¡¨å¤±è´¥:', key, e);
                                }
                                charts[key] = null;
                            }
                        });
                        charts = {};
                        
                        // æ¸…ç©ºç­›é€‰æ¡ä»¶
                        const searchInput = document.getElementById('searchInput');
                        const typeFilter = document.getElementById('typeFilter');
                        const reasoningFilter = document.getElementById('reasoningFilter');
                        const dateFilter = document.getElementById('dateFilter');
                        const customDate = document.getElementById('customDate');
                        if (searchInput) searchInput.value = '';
                        if (typeFilter) typeFilter.value = '';
                        if (reasoningFilter) reasoningFilter.value = '';
                        if (dateFilter) dateFilter.value = 'all';
                        if (customDate) {
                            customDate.value = '';
                            customDate.style.display = 'none';
                        }
                        
                        // æ˜¾ç¤ºç©ºçŠ¶æ€
                        const emptyState = document.getElementById('emptyState');
                        const content = document.getElementById('content');
                        if (emptyState) emptyState.style.display = 'block';
                        if (content) content.style.display = 'none';
                        
                        alert('âœ… CSVæ–‡ä»¶å·²æ¸…ç©ºï¼');
                    } else {
                        alert('âŒ æ¸…ç©ºå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                    }
                })
                .catch(error => {
                    console.error('æ¸…ç©ºCSVå¤±è´¥:', error);
                    alert('âŒ æ¸…ç©ºå¤±è´¥: ' + error.message);
                });
            }
        }

        // é¡µé¢åŠ è½½æ—¶å°è¯•åŠ è½½é»˜è®¤æ–‡ä»¶
        window.addEventListener('load', () => {
            // å°è¯•åŠ è½½é»˜è®¤æ–‡ä»¶ï¼Œå¤±è´¥æ—¶é™é»˜å¤„ç†ï¼ˆå¯èƒ½æ˜¯file://åè®®çš„CORSé™åˆ¶ï¼‰
            loadDefaultFile();
        });
    </script>
</body>
</html>
